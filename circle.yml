machine:
  node:
    version: v6.1.0
dependencies:
  override:
    - npm install
    - npm install --save-dev typings
    - npm install --save-dev webpack@beta
    - ./node_modules/.bin/typings install github:Microsoft/Bing-Maps-V8-TypeScript-Definitions/scripts/MicrosoftMaps/Microsoft.Maps.d.ts --global --save
    - ./node_modules/.bin/typings install github:Microsoft/Bing-Maps-V8-TypeScript-Definitions/scripts/MicrosoftMaps/Modules/Autosuggest.d.ts --global --save
    - ./node_modules/.bin/typings install github:Microsoft/Bing-Maps-V8-TypeScript-Definitions/scripts/MicrosoftMaps/Modules/Clustering.d.ts --global --save
    - ./node_modules/.bin/typings install github:Microsoft/Bing-Maps-V8-TypeScript-Definitions/scripts/MicrosoftMaps/Modules/Search.d.ts --global --save
    - ./node_modules/.bin/typings install dt~redux --global
    - ./node_modules/.bin/typings install react --save
    - ./node_modules/.bin/typings install react-dom --save
    - ./node_modules/.bin/typings install react-redux --save
compile:
  override:
    - ./node_modules/.bin/webpack --display-error-details
test:
  override:
    - '[ -f ./built/app.bundle.js ]'
deployment:
  production:
    branch: master
    commands:
      - echo 'Deploying to production'
  beta:
    branch: beta
    commands:
      - echo 'Deploying to beta'
      - aws s3 cp index.html s3://beta.homeontheroute.com
      - aws s3 sync --delete built s3://beta.homeontheroute.com/built
